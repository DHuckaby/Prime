package com.handlerexploit.prime.internal;

import java.util.concurrent.ThreadFactory;
import java.util.concurrent.atomic.AtomicInteger;

/**
 * Create thread with low priority for use {@link java.util.concurrent.Executor}
 * 
 * @hide
 */
public class LowPriorityThreadFactory implements ThreadFactory {

    private static final AtomicInteger COUNT = new AtomicInteger(1);

    private final AtomicInteger mThreadNumber = new AtomicInteger(1);
    private final String mNamePrefix = "Prime, Thread #" + COUNT.getAndIncrement();

    @Override
    public Thread newThread(final Runnable task) {
        Thread thread = new Thread(new Runnable() {

            @Override
            public void run() {
                android.os.Process.setThreadPriority(android.os.Process.THREAD_PRIORITY_BACKGROUND);
                task.run();
            }
        }, mNamePrefix + mThreadNumber.getAndIncrement());
        thread.setPriority(Thread.MIN_PRIORITY);
        return thread;
    }
}