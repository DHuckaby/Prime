package com.handlerexploit.prime.internal;

import android.content.res.Resources;
import android.graphics.Bitmap;
import android.graphics.drawable.BitmapDrawable;
import android.os.Build;
import android.support.v4.util.LruCache;
import com.handlerexploit.prime.MemoryCache;

public class BitmapMemoryLruCache extends LruCache<String, BitmapDrawable> implements MemoryCache {

    private final Resources resources;

    public BitmapMemoryLruCache(Resources resources, int maxSize) {
        super(maxSize);
        this.resources = resources;
    }

    @Override
    public int sizeOf(String key, BitmapDrawable value) {
        if (Build.VERSION.SDK_INT >= 11) {
            return value.getBitmap().getByteCount();
        } else {
            return value.getBitmap().getRowBytes() * value.getBitmap().getHeight();
        }
    }

    @Override
    public BitmapDrawable getCached(String key) {
        return get(key);
    }

    @Override
    public BitmapDrawable putCached(String key, Bitmap value) {
        BitmapDrawable drawable = new BitmapDrawable(resources, value);
        put(key, drawable);
        return drawable;
    }
}